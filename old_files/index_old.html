<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔥 Enhanced University Scheduling System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        
        .neon-glow {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
        }
        
        .gradient-text {
            background: linear-gradient(45deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            transition: all 0.3s ease;
        }
        
        .btn-gradient {
            background: linear-gradient(45deg, #667eea, #764ba2);
            transition: all 0.3s ease;
        }
        
        .btn-gradient:hover {
            background: linear-gradient(45deg, #764ba2, #667eea);
            transform: scale(1.05);
        }
        
        .table-modern {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }
        
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body class="p-4">
    <div x-data="schedulingApp()" class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="glass-effect rounded-3xl p-6 mb-8 text-center">
            <h1 class="text-4xl font-bold gradient-text mb-4">
                <i class="fas fa-rocket mr-3"></i>Enhanced University Scheduling System
            </h1>
            <p class="text-white/80 text-lg">Gen Z Style Dashboard - Modern, Fast, and Intuitive ✨</p>
        </div>

        <!-- Navigation Pills -->
        <div class="flex flex-wrap justify-center gap-4 mb-8">
            <button @click="currentTab = 'dashboard'" 
                    :class="currentTab === 'dashboard' ? 'btn-gradient text-white neon-glow' : 'glass-effect text-white/70'"
                    class="px-6 py-3 rounded-full font-semibold transition-all">
                <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
            </button>
            <button @click="currentTab = 'dosen'" 
                    :class="currentTab === 'dosen' ? 'btn-gradient text-white neon-glow' : 'glass-effect text-white/70'"
                    class="px-6 py-3 rounded-full font-semibold transition-all">
                <i class="fas fa-chalkboard-teacher mr-2"></i>Dosen
            </button>
            <button @click="currentTab = 'kuliah'" 
                    :class="currentTab === 'kuliah' ? 'btn-gradient text-white neon-glow' : 'glass-effect text-white/70'"
                    class="px-6 py-3 rounded-full font-semibold transition-all">
                <i class="fas fa-book-open mr-2"></i>Kuliah
            </button>
            <button @click="currentTab = 'waktu'" 
                    :class="currentTab === 'waktu' ? 'btn-gradient text-white neon-glow' : 'glass-effect text-white/70'"
                    class="px-6 py-3 rounded-full font-semibold transition-all">
                <i class="fas fa-clock mr-2"></i>Waktu
            </button>
            <button @click="currentTab = 'ruangan'" 
                    :class="currentTab === 'ruangan' ? 'btn-gradient text-white neon-glow' : 'glass-effect text-white/70'"
                    class="px-6 py-3 rounded-full font-semibold transition-all">
                <i class="fas fa-door-open mr-2"></i>Ruangan
            </button>
            <button @click="currentTab = 'preferences'" 
                    :class="currentTab === 'preferences' ? 'btn-gradient text-white neon-glow' : 'glass-effect text-white/70'"
                    class="px-6 py-3 rounded-full font-semibold transition-all">
                <i class="fas fa-heart mr-2"></i>Preferensi Dosen
            </button>
        </div>

        <!-- Dashboard Tab -->
        <div x-show="currentTab === 'dashboard'" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="glass-effect rounded-2xl p-6 card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-white/70 text-sm font-medium">Total Dosen</p>
                        <p class="text-3xl font-bold text-white" x-text="stats.dosen"></p>
                    </div>
                    <div class="w-12 h-12 bg-gradient-to-r from-pink-500 to-purple-600 rounded-full flex items-center justify-center">
                        <i class="fas fa-chalkboard-teacher text-white"></i>
                    </div>
                </div>
            </div>
            
            <div class="glass-effect rounded-2xl p-6 card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-white/70 text-sm font-medium">Total Kuliah</p>
                        <p class="text-3xl font-bold text-white" x-text="stats.kuliah"></p>
                    </div>
                    <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-cyan-600 rounded-full flex items-center justify-center">
                        <i class="fas fa-book-open text-white"></i>
                    </div>
                </div>
            </div>
            
            <div class="glass-effect rounded-2xl p-6 card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-white/70 text-sm font-medium">Slot Waktu</p>
                        <p class="text-3xl font-bold text-white" x-text="stats.waktu"></p>
                    </div>
                    <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-emerald-600 rounded-full flex items-center justify-center">
                        <i class="fas fa-clock text-white"></i>
                    </div>
                </div>
            </div>
            
            <div class="glass-effect rounded-2xl p-6 card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-white/70 text-sm font-medium">Ruangan</p>
                        <p class="text-3xl font-bold text-white" x-text="stats.ruangan"></p>
                    </div>
                    <div class="w-12 h-12 bg-gradient-to-r from-yellow-500 to-orange-600 rounded-full flex items-center justify-center">
                        <i class="fas fa-door-open text-white"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Tables -->
        <div x-show="currentTab === 'dosen'" class="glass-effect rounded-3xl p-6">
            <h2 class="text-2xl font-bold text-white mb-4">
                <i class="fas fa-chalkboard-teacher mr-3"></i>Data Dosen
            </h2>
            <div class="table-modern rounded-2xl overflow-hidden">
                <div class="overflow-x-auto scrollbar-hide max-h-96">
                    <table class="w-full">
                        <thead class="bg-gradient-to-r from-purple-600 to-blue-600 text-white">
                            <tr>
                                <th class="px-6 py-4 text-left font-semibold">NIDN</th>
                                <th class="px-6 py-4 text-left font-semibold">Nama Dosen</th>
                                <th class="px-6 py-4 text-left font-semibold">Kode Prodi</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="(dosen, index) in dosenData" :key="index">
                                <tr class="border-b border-gray-200 hover:bg-purple-50 transition-colors">
                                    <td class="px-6 py-4 font-mono text-sm" x-text="dosen.nidn"></td>
                                    <td class="px-6 py-4 font-semibold" x-text="dosen.nama"></td>
                                    <td class="px-6 py-4">
                                        <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium" x-text="dosen.kode_prodi"></span>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div x-show="currentTab === 'kuliah'" class="glass-effect rounded-3xl p-6">
            <h2 class="text-2xl font-bold text-white mb-4">
                <i class="fas fa-book-open mr-3"></i>Data Kuliah
            </h2>
            <div class="table-modern rounded-2xl overflow-hidden">
                <div class="overflow-x-auto scrollbar-hide max-h-96">
                    <table class="w-full">
                        <thead class="bg-gradient-to-r from-blue-600 to-cyan-600 text-white">
                            <tr>
                                <th class="px-6 py-4 text-left font-semibold">Kode</th>
                                <th class="px-6 py-4 text-left font-semibold">Mata Kuliah</th>
                                <th class="px-6 py-4 text-left font-semibold">Kelas</th>
                                <th class="px-6 py-4 text-left font-semibold">Dosen</th>
                                <th class="px-6 py-4 text-left font-semibold">SKS</th>
                                <th class="px-6 py-4 text-left font-semibold">Prodi</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="(kuliah, index) in kuliahData" :key="index">
                                <tr class="border-b border-gray-200 hover:bg-blue-50 transition-colors">
                                    <td class="px-6 py-4 font-mono text-sm" x-text="kuliah.kode_kuliah"></td>
                                    <td class="px-6 py-4 font-mono text-xs" x-text="kuliah.kode_matakuliah"></td>
                                    <td class="px-6 py-4 font-semibold" x-text="kuliah.nama_kelas"></td>
                                    <td class="px-6 py-4" x-text="kuliah.nama_dosen"></td>
                                    <td class="px-6 py-4">
                                        <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-bold" x-text="kuliah.sks + ' SKS'"></span>
                                    </td>
                                    <td class="px-6 py-4">
                                        <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium" x-text="kuliah.kode_prodi"></span>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div x-show="currentTab === 'waktu'" class="glass-effect rounded-3xl p-6">
            <h2 class="text-2xl font-bold text-white mb-4">
                <i class="fas fa-clock mr-3"></i>Slot Waktu (50 Menit Interval) ⏰
            </h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <template x-for="day in ['SENIN', 'SELASA', 'RABU', 'KAMIS', 'JUMAT', 'SABTU']" :key="day">
                    <div class="table-modern rounded-2xl overflow-hidden">
                        <div class="bg-gradient-to-r from-green-600 to-emerald-600 text-white px-6 py-3">
                            <h3 class="font-bold" x-text="day"></h3>
                        </div>
                        <div class="p-4 space-y-2">
                            <template x-for="(waktu, index) in waktuData.filter(w => w.nama_hari === day)" :key="index">
                                <div class="flex justify-between items-center p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl">
                                    <span class="font-mono text-sm bg-green-100 px-2 py-1 rounded" x-text="'Kode: ' + waktu.kode_waktu"></span>
                                    <span class="font-bold text-green-800" x-text="waktu.waktu"></span>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <div x-show="currentTab === 'ruangan'" class="glass-effect rounded-3xl p-6">
            <h2 class="text-2xl font-bold text-white mb-4">
                <i class="fas fa-door-open mr-3"></i>Data Ruangan
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <template x-for="(ruangan, index) in ruanganData" :key="index">
                    <div class="table-modern rounded-2xl p-6 card-hover">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-gradient-to-r from-yellow-500 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-door-open text-white text-2xl"></i>
                            </div>
                            <h3 class="font-bold text-xl text-gray-800" x-text="ruangan.nama_ruangan"></h3>
                            <p class="text-gray-600 mt-2">ID: <span class="font-mono" x-text="ruangan.id"></span></p>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- Preferensi Dosen Tab -->
        <div x-show="currentTab === 'preferences'" class="glass-effect rounded-3xl p-6">
            <h2 class="text-2xl font-bold text-white mb-6">
                <i class="fas fa-heart mr-3"></i>Preferensi Waktu Dosen 💝
            </h2>
            
            <!-- Form Input -->
            <div class="table-modern rounded-2xl p-6 mb-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Tambah Preferensi Baru</h3>
                <form @submit.prevent="addPreference()">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Pilih Dosen</label>
                            <select x-model="newPreference.nidn" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="">-- Pilih Dosen --</option>
                                <template x-for="dosen in dosenData" :key="dosen.nidn">
                                    <option :value="dosen.nidn" x-text="dosen.nama + ' (' + dosen.nidn + ')'"></option>
                                </template>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Hari</label>
                            <select x-model="newPreference.hari" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="">-- Pilih Hari --</option>
                                <option value="SENIN">Senin</option>
                                <option value="SELASA">Selasa</option>
                                <option value="RABU">Rabu</option>
                                <option value="KAMIS">Kamis</option>
                                <option value="JUMAT">Jumat</option>
                                <option value="SABTU">Sabtu</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Waktu yang Disukai</label>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                            <template x-for="waktu in waktuData.filter(w => w.nama_hari === newPreference.hari)" :key="waktu.kode_waktu">
                                <label class="flex items-center space-x-2 p-3 border rounded-xl cursor-pointer hover:bg-green-50">
                                    <input type="checkbox" :value="waktu.kode_waktu" x-model="newPreference.waktu_suka" class="text-green-600">
                                    <span class="text-sm font-mono" x-text="waktu.waktu"></span>
                                </label>
                            </template>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Waktu yang Tidak Bisa</label>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                            <template x-for="waktu in waktuData.filter(w => w.nama_hari === newPreference.hari)" :key="waktu.kode_waktu">
                                <label class="flex items-center space-x-2 p-3 border rounded-xl cursor-pointer hover:bg-red-50">
                                    <input type="checkbox" :value="waktu.kode_waktu" x-model="newPreference.waktu_tidak_bisa" class="text-red-600">
                                    <span class="text-sm font-mono" x-text="waktu.waktu"></span>
                                </label>
                            </template>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn-gradient text-white px-6 py-3 rounded-xl font-semibold">
                        <i class="fas fa-plus mr-2"></i>Tambah Preferensi
                    </button>
                </form>
            </div>

            <!-- Daftar Preferensi -->
            <div class="table-modern rounded-2xl overflow-hidden">
                <div class="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-4">
                    <h3 class="text-lg font-bold">Daftar Preferensi Waktu Dosen</h3>
                </div>
                <div class="overflow-x-auto scrollbar-hide max-h-96">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-4 text-left font-semibold text-gray-700">Dosen</th>
                                <th class="px-6 py-4 text-left font-semibold text-gray-700">Hari</th>
                                <th class="px-6 py-4 text-left font-semibold text-gray-700">Waktu Suka</th>
                                <th class="px-6 py-4 text-left font-semibold text-gray-700">Waktu Tidak Bisa</th>
                                <th class="px-6 py-4 text-left font-semibold text-gray-700">Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="(pref, index) in preferenceData" :key="index">
                                <tr class="border-b border-gray-200 hover:bg-purple-50 transition-colors">
                                    <td class="px-6 py-4 font-semibold" x-text="pref.nama_dosen"></td>
                                    <td class="px-6 py-4">
                                        <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium" x-text="pref.hari"></span>
                                    </td>
                                    <td class="px-6 py-4">
                                        <div class="flex flex-wrap gap-1">
                                            <template x-for="waktu in pref.waktu_suka_detail" :key="waktu">
                                                <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs" x-text="waktu"></span>
                                            </template>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4">
                                        <div class="flex flex-wrap gap-1">
                                            <template x-for="waktu in pref.waktu_tidak_bisa_detail" :key="waktu">
                                                <span class="bg-red-100 text-red-800 px-2 py-1 rounded text-xs" x-text="waktu"></span>
                                            </template>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4">
                                        <button @click="deletePreference(index)" class="text-red-600 hover:text-red-800 transition-colors">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        function schedulingApp() {
            return {
                currentTab: 'dashboard',
                stats: {
                    dosen: 0,
                    kuliah: 0,
                    waktu: 0,
                    ruangan: 0
                },
                dosenData: [],
                kuliahData: [],
                waktuData: [],
                ruanganData: [],
                preferenceData: [],
                newPreference: {
                    nidn: '',
                    hari: '',
                    waktu_suka: [],
                    waktu_tidak_bisa: []
                },

                init() {
                    this.loadData();
                },

                async loadData() {
                    try {
                        console.log('Loading data from API...');
                        // Load all data from backend
                        const response = await fetch('/api/data');
                        
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        
                        const data = await response.json();
                        
                        this.dosenData = data.dosen || [];
                        this.kuliahData = data.kuliah || [];
                        this.waktuData = data.waktu || [];
                        this.ruanganData = data.ruangan || [];
                        this.preferenceData = data.preferences || [];
                        
                        // Update stats
                        this.stats = {
                            dosen: this.dosenData.length,
                            kuliah: this.kuliahData.length,
                            waktu: this.waktuData.length,
                            ruangan: this.ruanganData.length
                        };
                        
                        console.log('Data loaded successfully:', this.stats);
                    } catch (error) {
                        console.error('Error loading data:', error);
                        alert('⚠️ Could not connect to database. Please make sure the Flask server is running.');
                        // Fallback to sample data for demo
                        this.loadSampleData();
                    }
                },

                loadSampleData() {
                    // Sample data for demo purposes when backend is not available
                    console.log('Loading sample data...');
                    
                    this.stats = {
                        dosen: 2,
                        kuliah: 1,
                        waktu: 4,
                        ruangan: 2
                    };
                    
                    this.dosenData = [
                        { nidn: '0125017702', nama: 'ANDI SALSA ANGGERAINI', kode_prodi: '11201' },
                        { nidn: '0901037802', nama: 'ANDI NILAWATI', kode_prodi: '11201' }
                    ];
                    
                    this.kuliahData = [
                        { kode_kuliah: '1', kode_matakuliah: 'AW6202012201', nama_kelas: '2 A', nama_dosen: 'ABD. RAHMAN', sks: '2', kode_prodi: '20201' }
                    ];
                    
                    this.waktuData = [
                        { kode_waktu: '1', nama_hari: 'SENIN', waktu: '07:00' },
                        { kode_waktu: '2', nama_hari: 'SENIN', waktu: '07:50' },
                        { kode_waktu: '8', nama_hari: 'SELASA', waktu: '07:00' },
                        { kode_waktu: '9', nama_hari: 'SELASA', waktu: '07:50' }
                    ];
                    
                    this.ruanganData = [
                        { id: '1', nama_ruangan: 'KB3.13' },
                        { id: '2', nama_ruangan: 'KB3.14' }
                    ];
                    
                    this.preferenceData = [
                        { 
                            id: 1, 
                            nama_dosen: 'ANDI SALSA ANGGERAINI', 
                            hari: 'SENIN', 
                            waktu_suka_detail: ['07:00', '07:50'], 
                            waktu_tidak_bisa_detail: ['11:10'] 
                        }
                    ];
                },

                async addPreference() {
                    if (!this.newPreference.nidn || !this.newPreference.hari) {
                        alert('Harap pilih dosen dan hari!');
                        return;
                    }

                    try {
                        const response = await fetch('/api/preferences', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(this.newPreference)
                        });

                        if (response.ok) {
                            this.loadData(); // Reload data
                            this.resetForm();
                            alert('Preferensi berhasil ditambahkan!');
                        }
                    } catch (error) {
                        console.error('Error adding preference:', error);
                        alert('Error: ' + error.message);
                    }
                },

                async deletePreference(index) {
                    if (confirm('Hapus preferensi ini?')) {
                        try {
                            const pref = this.preferenceData[index];
                            const response = await fetch(`/api/preferences/${pref.id}`, {
                                method: 'DELETE'
                            });

                            if (response.ok) {
                                this.preferenceData.splice(index, 1);
                                alert('Preferensi berhasil dihapus!');
                            }
                        } catch (error) {
                            console.error('Error deleting preference:', error);
                        }
                    }
                },

                resetForm() {
                    this.newPreference = {
                        nidn: '',
                        hari: '',
                        waktu_suka: [],
                        waktu_tidak_bisa: []
                    };
                }
            }
        }
    </script>
</body>
</html>